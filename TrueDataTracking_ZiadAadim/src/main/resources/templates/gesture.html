<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Gesture</title>
    <link rel="stylesheet" th:href="@{/css/css/styles.css}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <h1>Gesture</h1>
    <h2>Select a Topic</h2>
    <a href="/main" class="back-button">Go Back</a>
    <div class="course-wrapper">
        <a href="/loading" class="course-card" onclick="logCardClick(event, 'gesture', 'Gesture Introduction')">
            <div class="image-placeholder"></div>
            <div class="course-info">
                <h3>Gesture Introduction</h3>
                <p>Learn the fundamentals of gesture drawing.</p>
            </div>
        </a>
        <a href="/gesture/timed" class="course-card" onclick="logCardClick(event, 'gesture', 'Gesture Basic Shapes')">
            <div class="image-placeholder"></div>
            <div class="course-info">
                <h3>Gesture Basic Shapes</h3>
                <p>Improve your understanding of gesture shapes and forms.</p>
            </div>
        </a>
        <a href="/gesture/timed" class="course-card" onclick="logCardClick(event, 'gesture', 'Timed Gesture Training')">
            <div class="image-placeholder"></div>
            <div class="course-info">
                <h3>Timed Gesture Training</h3>
                <p>Practice gestures with timed sessions for better flow.</p>
            </div>
        </a>
    </div>
</div>

<script>
    // General event logger for all course cards
    function logCardClick(event, page, section) {
        event.preventDefault(); // Prevent navigation

        // Retrieve userId from sessionStorage
        const userId = sessionStorage.getItem("userId");
        if (!userId) {
            console.error("User ID not set!");
            return;
        }

        const data = {
            eventType: "BUTTON_CLICK",
            page: page,
            buttonClicked: section,
            timestamp: new Date().toISOString(),
            userId: userId
        };

        fetch('/api/events/log', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (response.ok) {
                    console.log(`${section} click logged on page: ${page}`);
                } else {
                    console.error("Failed to log click event.");
                }
            })
            .catch(error => console.error("Error logging click:", error));

        // Navigate to the link after logging
        const href = event.target.closest("a").getAttribute("href");
        if (href) {
            window.location.href = href;
        }
    }
</script>
</body>
</html>
